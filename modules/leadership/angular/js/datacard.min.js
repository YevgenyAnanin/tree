var dataCard=angular.module("dataCard",["ngSanitize","smgGaEvent"]);dataCard.controller("DataCardCtrl",["$scope","$attrs","$timeout","gaEventWrapper",function(a,b,c,d){if(a.nid=b.nid,a.tid=b.tid,a.site=b.site,a.photos=[],a.parentHover=!1,a.dataCardHover=!1,Drupal.settings.hasOwnProperty("leadershipDatacard")&&Drupal.settings.leadershipDatacard.hasOwnProperty(a.tid))for(var e in Drupal.settings.leadershipDatacard[a.tid])if(Drupal.settings.leadershipDatacard[a.tid][e].datacard_nid==a.nid){var f=Drupal.settings.leadershipDatacard[a.tid][e],g=f.data_card_processed_for_angular;if(a.contactPhotoPath=g.hasOwnProperty("contact_photo_path")?g.contact_photo_path:!1,a.contactName=g.hasOwnProperty("contact_name")?g.contact_name:"",a.contactTitle=g.hasOwnProperty("contact_title")?g.contact_title:"",a.companyLogoPath=g.hasOwnProperty("company_logo_path")?g.company_logo_path:!1,a.companyWebsite=f.hasOwnProperty("company_website")?f.company_website:"",a.productSummary=g.hasOwnProperty("product_summary")?g.product_summary:"",a.companyName=f.hasOwnProperty("title")?f.title:"",a.teaser=g.hasOwnProperty("teaser")?g.teaser:"",g.hasOwnProperty("product_photos")&&g.product_photos.length>0)for(j=0;j<g.product_photos.length;j++){var h=g.product_photos[j];photoObj={url:h.hasOwnProperty("product_photo")?h.product_photo:"",link:h.hasOwnProperty("product_link")?h.product_link:"",title:h.hasOwnProperty("product_title")?h.product_title:""},a.photos.push(photoObj)}a.printProfileNid=f.hasOwnProperty("print_profile_nid")?f.print_profile_nid:"",a.companyNid=e,a.companyHasWaywireVideos=!1,f.waywire_videos.hasOwnProperty(a.companyNid)&&f.waywire_videos[a.companyNid].hasOwnProperty("videos")&&(a.companyHasWaywireVideos=!0);break}a.gaEvent=function(a,b,c,e){return d.gaEvent(a,b,c,e)},a.$on("leadershipHoverBegin",function(){a.$apply(function(){a.parentHover=!0})}),a.$on("leadershipHoverEnd",function(){a.$apply(function(){a.parentHover=!1})}),a.contactShowComma=function(){return a.contactName.length>0&&a.contactTitle.length>0?",":""},a.setParentHoverFalse=function(){a.parentHover=!1}}]),dataCard.controller("leadershipLinkCtrl",["$scope","$rootScope",function(a){a.hoverOn=!1,a.broadcastHoverBegin=function(){a.$broadcast("leadershipHoverBegin",{}),a.hoverOn=!0},a.broadcastHoverEnd=function(){a.$broadcast("leadershipHoverEnd",{}),a.hoverOn=!1}}]),dataCard.directive("leadershipLink",[function(){return{restrict:"A",scope:!0,controller:"leadershipLinkCtrl",link:function(a,b){var c=b.find(".leadership-link"),d=c.position().left+c.width();b.on({mouseover:function(c){xOffset=void 0==c.offsetX?c.pageX-b.offset().left:c.offsetX,d+20>xOffset&&a.broadcastHoverBegin()},mouseleave:function(){a.broadcastHoverEnd()}}),b.find("a.leadership-link").each(function(b,c){var d=jQuery(c);d.hasClass("touchstart-off")||d.addClass("touchstart-off"),d.on("touchstart",function(b){d.hasClass("touchstart-off")?(b.preventDefault(),b.stopPropagation(),b.stopImmediatePropagation(),d.addClass("touchstart-begin").removeClass("touchstart-off"),a.broadcastHoverBegin()):window.location.href=d.attr("href")})})}}}]),dataCard.directive("leadershipDataCard",["$window","$http","$compile",function(a){var b=Drupal.settings.smgAngularTemplates.dataCard;return{restrict:"E",replace:!0,scope:!0,controller:"DataCardCtrl",link:function(b,c){b.currentDataCardHover=!1,c.on({mouseenter:function(){b.dataCardHover=!0},mouseleave:function(){b.dataCardHover=!1}}),b.getDistanceToBottom=function(b){var c=angular.element(a).scrollTop(),d=b.offset().top,e=d-c,f=angular.element(a).height(),g=f-e;return g},b.checkTouchEvent=function(a){var d=c[0].getBoundingClientRect();if(jQuery(a.target).hasClass("touchstart-begin"))return!1;var e=a.pageY-jQuery(window).scrollTop();e<=d.bottom&&e>=d.top&&a.pageX<=d.right&&a.pageX>=d.left?b.currentDataCardHover=!0:(b.currentDataCardHover=!1,b.$apply())},b.$watch("parentHover",function(){if(b.parentHover){var d=angular.element(a).width(),e=d>500?"500px":"90%",f="-50%";c.css({visibility:"hidden"}),c.css({width:e,display:"block"});var g=c.outerHeight();if(c.find(".videoWidget").length){var h=c.find(".videoWidget");h.find(".videoWidget-video").width()||(g=c.find(".dataCard-top").outerHeight()+225)}var i=b.getDistanceToBottom(c.parent()),j=function(){var a=c.parent().outerHeight(!0),d=b.getDistanceToBottom(c),e=d-i;return e+.5*a};g-20>i&&(f=-1*(g-i+20),f+="px"),c.css({top:f,visibility:"visible"});var k=j(),l=c.find(".dataCard-after-arrow");parseInt(k)>g-20?l.css({display:"none"}):(l.css({display:"block"}),b.currentDataCardHover=!0,document.addEventListener("touchstart",b.checkTouchEvent,!0)),l.css({top:k})}else b.dataCardHover||(c.css({display:""}),b.currentDataCardHover=!1);b.$watch("currentDataCardHover",function(){b.currentDataCardHover||(document.removeEventListener("touchstart",b.checkTouchEvent,!0),c.css({display:""}),b.setParentHoverFalse(),c.siblings(".touchstart-begin").each(function(a,b){jQuery(b).removeClass("touchstart-begin").addClass("touchstart-off")}),c.siblings(".link-section").each(function(a,b){jQuery(b).find("a.leadership-link").removeClass("touchstart-begin").addClass("touchstart-off")}))})})},templateUrl:b}}]),dataCard.directive("compileDataCard",["$compile",function(a){return{restrict:"E",scope:{nid:"@",tid:"@",site:"@"},replace:!0,link:function(b,c,d){b.interpValues={interpNid:!1,interpTid:!1,interpSite:!1},d.$observe("nid",function(a){b.interpValues.interpNid=a}),d.$observe("tid",function(a){b.interpValues.interpTid=a}),d.$observe("site",function(a){b.interpValues.interpSite=a}),b.$watchCollection("interpValues",function(d){if(d.interpTid&&d.interpTid&&d.interpSite){var e=angular.element('<leadership-data-card nid="'+b.nid+'" tid="'+b.tid+'" site="'+b.site+'"></leadership-data-card>'),f=a(e)(b);c.replaceWith(f)}})}}}]),dataCard.directive("compileVideoWidget",["$compile","$window",function(a,b){return{restrict:"E",scope:{nid:"@",tid:"@"},replace:!0,link:function(c,d,e){var f=angular.element(b);c.interpDataCardValues={interpNid:!1,interpTid:!1},e.$observe("nid",function(a){c.interpDataCardValues.interpNid=a}),e.$observe("tid",function(a){c.interpDataCardValues.interpTid=a}),c.$watchCollection("interpDataCardValues",function(b){if(b.interpNid&&b.interpTid){var e=angular.element('<video-widget datacard="true" nid="'+c.nid+'" tid="'+c.tid+'" ></video-widget>');if(f.width()>480){var g=a(e)(c);d.replaceWith(g)}}})}}}]),dataCard.directive("smgAnchorGaEvent",[function(){return{restrict:"A",link:function(a,b){angular.element(b).click(function(a){a.preventDefault(),a.stopPropagation()})}}}]),window.smgAngularDependencies.push("dataCard");